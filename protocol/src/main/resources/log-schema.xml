<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sbe:messageSchema xmlns:sbe="http://www.fixprotocol.org/ns/simple/RC3" package="org.camunda.tngp.protocol.log"
  id="5" version="1" semanticVersion="0.1.0" description="Tngp Log Protocol" byteOrder="littleEndian">

  <types>
    <composite name="messageHeader" description="Message identifiers and length of message root">
      <type name="blockLength" primitiveType="uint16" />
      <type name="templateId" primitiveType="uint16" />
      <type name="schemaId" primitiveType="uint16" />
      <type name="version" primitiveType="uint16" />
      <type name="resourceId" primitiveType="uint16" />
      <type name="shardId" primitiveType="uint16" />
      <type name="source" primitiveType="uint8" />
      <type name="sourceEventPosition" primitiveType="uint64" />
      <type name="sourceEventLogId" primitiveType="uint16" />
    </composite>
    <composite name="varDataEncoding">
      <type name="length" primitiveType="uint16" />
      <type name="varData" primitiveType="uint8" length="0" characterEncoding="UTF-8" />
    </composite>
    <composite name="groupSizeEncoding" description="Repeating group dimensions">
      <type name="blockLength" primitiveType="uint16" />
      <type name="numInGroup" primitiveType="uint8" semanticType="NumInGroup" />
    </composite>
  </types>

  <types>
    <enum name="TaskInstanceState" encodingType="uint8">
      <validValue name="NEW">0</validValue>
      <validValue name="LOCKED">1</validValue>
      <validValue name="COMPLETED">2</validValue>
    </enum>
    <enum name="WorkflowInstanceEventType" encodingType="uint8">
      <validValue name="NEW">0</validValue>
      <validValue name="ACTIVE">1</validValue>
      <validValue name="COMPLETED">2</validValue>
    </enum>
    <enum name="AvtivityInstanceEventType" encodingType="uint8">
      <validValue name="NEW">0</validValue>
      <validValue name="ACTIVE">1</validValue>
      <validValue name="COMPLETED">2</validValue>
    </enum>
    <enum name="ProcessInstanceRequestType" encodingType="uint8">
      <validValue name="NEW">0</validValue>
    </enum>
    <enum name="ActivityInstanceRequestType" encodingType="uint8">
      <validValue name="COMPLETE">0</validValue>
    </enum>
    <enum name="TaskInstanceRequestType" encodingType="uint8">
      <validValue name="COMPLETE">0</validValue>
    </enum>
    <enum name="WfDefinitionRequestType" encodingType="uint8">
      <validValue name="NEW">0</validValue>
    </enum>
    <type name="Date" primitiveType="uint64" semanticType="Date" />
  </types>

  <!-- task queue -->
  <sbe:message name="TaskInstance" id="1" description="A task Instance">
    <field name="id" id="1" type="uint64" />
    <field name="version" id="2" type="uint16" />
    <field name="prevVersionPosition" id="2" type="uint64" />
    <field name="state" id="3" type="TaskInstanceState" />
    <field name="lockTime" id="4" type="uint64" />
    <field name="lockOwnerId" id="5" type="uint32" />
    <field name="taskTypeHash" id="6" type="uint32" />
    <field name="wfRuntimeResourceId" id="7" type="uint16" />
    <field name="wfActivityInstanceEventKey" id="8" type="uint64" />
    <field name="wfInstanceId" id="9" type="uint64" />
    <data name="taskType" id="10" type="varDataEncoding" />
    <data name="payload" id="11" type="varDataEncoding" />
  </sbe:message>
  
  <sbe:message name="TaskInstanceRequest" id="9">
    <field name="type" id="1" type="TaskInstanceRequestType" />
    <field name="key" id="2" type="uint64" />
    <field name="lockOwnerId" id="3" type="uint64" />
    <data name="payload" id="4" type="varDataEncoding" />
  </sbe:message>
  
  <sbe:message name="CreateTaskRequest" id="10">
    <field name="type" id="1" type="TaskInstanceRequestType" />
    <data name="taskType" id="2" type="varDataEncoding" />
  </sbe:message>

  <!-- runtime -->
  <sbe:message name="BpmnProcessEvent" id="4">
    <field name="key" id="1" type="uint64" />
    <field name="event" id="2" type="uint16" />
    <field name="wfDefinitionId" id="3" type="uint64" />
    <field name="wfInstanceId" id="4" type="uint64" />
    <field name="initialElementId" id="5" type="uint16" />
    <field name="bpmnBranchKey" id="6" type="uint64" />
  </sbe:message>

  <sbe:message name="BpmnFlowElementEvent" id="5">
    <field name="key" id="1" type="uint64" />
    <field name="event" id="2" type="uint16" />
    <field name="wfDefinitionId" id="3" type="uint64" />
    <field name="wfInstanceId" id="4" type="uint64" />
    <field name="flowElementId" id="5" type="uint16" />
    <field name="bpmnBranchKey" id="6" type="uint64" />
    <data name="flowElementIdString" id="7" type="varDataEncoding" />
  </sbe:message>

  <sbe:message name="BpmnActivityEvent" id="6">
    <field name="key" id="1" type="uint64" />
    <field name="event" id="2" type="uint16" />
    <field name="wfDefinitionId" id="3" type="uint64" />
    <field name="wfInstanceId" id="4" type="uint64" />
    <field name="flowElementId" id="5" type="uint16" />
    <field name="taskQueueId" id="6" type="uint16" />
    <field name="bpmnBranchKey" id="6" type="uint64" />
    <data name="taskType" id="7" type="varDataEncoding" />
    <data name="flowElementIdString" id="8" type="varDataEncoding" />
    <data name="payload" id="9" type="varDataEncoding" />
  </sbe:message>
  
  <sbe:message name="BpmnBranchEvent" id="11">
    <field name="key" id="0" type="uint64" /> <!-- TODO: this is obsolete when key is in header; but this is not yet accessible in Java API -->
    <group name="delta" id="1" dimensionType="groupSizeEncoding">
	  <field name="commitId" id="2" type="uint64"/>
	  <data name="diff" id="3" type="varDataEncoding" />
    </group>
    <data name="materializedPayload" id="4" type="varDataEncoding" />
  </sbe:message>
  
  <sbe:message name="WorkflowInstanceRequest" id="7">
    <field name="type" id="1" type="ProcessInstanceRequestType" />
    <field name="wfDefinitionId" id="2" type="uint64" />
    <field name="wfInstanceId" id="3" type="uint64" />
    <data name="wfDefinitionKey" id="4" type="varDataEncoding" />
  </sbe:message>
  
  <sbe:message name="ActivityInstanceRequest" id="8">
    <field name="type" id="1" type="ActivityInstanceRequestType" />
    <field name="key" id="2" type="uint64" />
    <data name="payload" id="3" type="varDataEncoding" />
  </sbe:message>

  <sbe:message name="WfDefinition" id="2" description="A Workflow Type">
    <field name="id" id="1" type="uint64" />
    <data name="key" id="2" type="varDataEncoding" />
    <data name="resource" id="3" type="varDataEncoding" />
  </sbe:message>
  <sbe:message name="WfDefinitionRequest" id="3" description="A Workflow Type">
    <field name="type" id="1" type="WfDefinitionRequestType" />
    <data name="resource" id="2" type="varDataEncoding" />
  </sbe:message>

</sbe:messageSchema>